[debug] [2025-07-09T20:00:36.418Z] ----------------------------------------------------------------------
[debug] [2025-07-09T20:00:36.432Z] Command:       /nix/store/rbdrkcs5kkwpalxcd7c6bnm33lk2955n-nodejs-20.19.0/bin/node /nix/store/fprgfkwna33crhc86jqbf5878piivvgw-firebase-tools-14.7.0/lib/node_modules/firebase-tools/lib/bin/firebase.js emulators:start --project=demo-app --only=auth,firestore
[debug] [2025-07-09T20:00:36.434Z] CLI Version:   14.7.0
[debug] [2025-07-09T20:00:36.434Z] Platform:      linux
[debug] [2025-07-09T20:00:36.435Z] Node Version:  v20.19.0
[debug] [2025-07-09T20:00:36.435Z] Time:          Wed Jul 09 2025 20:00:36 GMT+0000 (Coordinated Universal Time)
[debug] [2025-07-09T20:00:36.436Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-07-09T20:00:36.453Z] >>> [apiv2][query] GET https://firebase-public.firebaseio.com/cli.json [none]
[debug] [2025-07-09T20:00:38.259Z] <<< [apiv2][status] GET https://firebase-public.firebaseio.com/cli.json 200
[debug] [2025-07-09T20:00:38.259Z] <<< [apiv2][body] GET https://firebase-public.firebaseio.com/cli.json {"cloudBuildErrorAfter":1594252800000,"cloudBuildWarnAfter":1590019200000,"defaultNode10After":1594252800000,"minVersion":"3.0.5","node8DeploysDisabledAfter":1613390400000,"node8RuntimeDisabledAfter":1615809600000,"node8WarnAfter":1600128000000}
[debug] [2025-07-09T20:00:38.657Z] openjdk version "21.0.5" 2024-10-15

[debug] [2025-07-09T20:00:38.658Z] OpenJDK Runtime Environment (build 21.0.5+1-nixos)
OpenJDK 64-Bit Server VM (build 21.0.5+1-nixos, mixed mode, sharing)

[debug] [2025-07-09T20:00:38.695Z] Parsed Java major version: 21
[info] i  emulators: Starting emulators: firestore {"metadata":{"emulator":{"name":"hub"},"message":"Starting emulators: firestore"}}
[info] i  emulators: Detected demo project ID "demo-app", emulated services will use a demo configuration and attempts to access non-emulated services for this project will fail. {"metadata":{"emulator":{"name":"hub"},"message":"Detected demo project ID \"demo-app\", emulated services will use a demo configuration and attempts to access non-emulated services for this project will fail."}}
[warn] ⚠  auth: Not starting the auth emulator, make sure you have run firebase init. {"metadata":{"emulator":{"name":"auth"},"message":"Not starting the auth emulator, make sure you have run firebase init."}}
[warn] ⚠  hub: Error when trying to check port 4400 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4400 {"metadata":{"emulator":{"name":"hub"},"message":"Error when trying to check port 4400 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4400"}}
[warn] ⚠  hub: Port 4400 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"hub"},"message":"Port 4400 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  hub: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"hub"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  ui: Error when trying to check port 4000 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4000 {"metadata":{"emulator":{"name":"ui"},"message":"Error when trying to check port 4000 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4000"}}
[warn] ⚠  ui: Port 4000 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"ui"},"message":"Port 4000 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  ui: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"ui"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  logging: Error when trying to check port 4500 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4500 {"metadata":{"emulator":{"name":"logging"},"message":"Error when trying to check port 4500 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4500"}}
[warn] ⚠  logging: Port 4500 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"logging"},"message":"Port 4500 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  logging: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"logging"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  firestore: Error when trying to check port 8080 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:8080 {"metadata":{"emulator":{"name":"firestore"},"message":"Error when trying to check port 8080 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:8080"}}
[warn] ⚠  firestore: Port 8080 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"firestore"},"message":"Port 8080 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  firestore: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"firestore"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  firestore.websocket: Error when trying to check port 9150 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:9150 {"metadata":{"emulator":{"name":"firestore"},"message":"Error when trying to check port 9150 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:9150"}}
[warn] ⚠  firestore: Port 9150 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"firestore"},"message":"Port 9150 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  firestore: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"firestore"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[debug] [2025-07-09T20:00:38.715Z] assigned listening specs for emulators {"user":{"hub":[{"address":"127.0.0.1","family":"IPv4","port":4400}],"ui":[{"address":"127.0.0.1","family":"IPv4","port":4000}],"logging":[{"address":"127.0.0.1","family":"IPv4","port":4500}],"firestore":[{"address":"127.0.0.1","family":"IPv4","port":8080}],"firestore.websocket":[{"address":"127.0.0.1","family":"IPv4","port":9150}]},"metadata":{"message":"assigned listening specs for emulators"}}
[debug] [2025-07-09T20:00:38.724Z] [hub] writing locator at /tmp/hub-demo-app.json
[debug] [2025-07-09T20:00:38.747Z] Ignoring unsupported arg: auto_download {"metadata":{"emulator":{"name":"firestore"},"message":"Ignoring unsupported arg: auto_download"}}
[debug] [2025-07-09T20:00:38.748Z] Ignoring unsupported arg: single_project_mode_error {"metadata":{"emulator":{"name":"firestore"},"message":"Ignoring unsupported arg: single_project_mode_error"}}
[debug] [2025-07-09T20:00:38.748Z] Starting Firestore Emulator with command {"binary":"java","args":["-Dgoogle.cloud_firestore.debug_log_level=FINE","-Duser.language=en","-jar","/nix/store/w60wgw0k95kiq4yl5f561xhydyg07gf7-emulators/cloud-firestore-emulator-v1.19.8.jar","--host","127.0.0.1","--port",8080,"--websocket_port",9150,"--project_id","demo-app","--rules","/home/user/studio/firestore.rules","--single_project_mode",true],"optionalArgs":["port","webchannel_port","host","rules","websocket_port","functions_emulator","seed_from_export","project_id","single_project_mode"],"joinArgs":false,"shell":false,"port":8080} {"metadata":{"emulator":{"name":"firestore"},"message":"Starting Firestore Emulator with command {\"binary\":\"java\",\"args\":[\"-Dgoogle.cloud_firestore.debug_log_level=FINE\",\"-Duser.language=en\",\"-jar\",\"/nix/store/w60wgw0k95kiq4yl5f561xhydyg07gf7-emulators/cloud-firestore-emulator-v1.19.8.jar\",\"--host\",\"127.0.0.1\",\"--port\",8080,\"--websocket_port\",9150,\"--project_id\",\"demo-app\",\"--rules\",\"/home/user/studio/firestore.rules\",\"--single_project_mode\",true],\"optionalArgs\":[\"port\",\"webchannel_port\",\"host\",\"rules\",\"websocket_port\",\"functions_emulator\",\"seed_from_export\",\"project_id\",\"single_project_mode\"],\"joinArgs\":false,\"shell\":false,\"port\":8080}"}}
[info] i  firestore: Firestore Emulator logging to firestore-debug.log {"metadata":{"emulator":{"name":"firestore"},"message":"Firestore Emulator logging to firestore-debug.log"}}
[debug] [2025-07-09T20:00:42.439Z] Jul 09, 2025 8:00:42 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketServer start
INFO: Started WebSocket server on ws://127.0.0.1:9150
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 09, 2025 8:00:42 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketServer start\nINFO: Started WebSocket server on ws://127.0.0.1:9150\n"}}
[debug] [2025-07-09T20:00:42.500Z] API endpoint: http:// {"metadata":{"emulator":{"name":"firestore"},"message":"API endpoint: http://"}}
[debug] [2025-07-09T20:00:42.501Z] 127.0.0.1:8080
If you are using a library that supports the FIRESTORE_EMULATOR_HOST environment variable, run:

   export FIRESTORE_EMULATOR_HOST=127.0.0.1:8080

If you are running a Firestore in Datastore Mode project, run:

   export DATASTORE_EMULATOR_HOST=127.0.0.1:8080

Note: Support for Datastore Mode is in preview. If you encounter any bugs please file at https://github.com/firebase/firebase-tools/issues.
Dev App Server is now running.

 {"metadata":{"emulator":{"name":"firestore"},"message":"127.0.0.1:8080\nIf you are using a library that supports the FIRESTORE_EMULATOR_HOST environment variable, run:\n\n   export FIRESTORE_EMULATOR_HOST=127.0.0.1:8080\n\nIf you are running a Firestore in Datastore Mode project, run:\n\n   export DATASTORE_EMULATOR_HOST=127.0.0.1:8080\n\nNote: Support for Datastore Mode is in preview. If you encounter any bugs please file at https://github.com/firebase/firebase-tools/issues.\nDev App Server is now running.\n\n"}}
[info] ✔  firestore: Firestore Emulator UI websocket is running on 9150. {"metadata":{"emulator":{"name":"firestore"},"message":"Firestore Emulator UI websocket is running on 9150."}}
[debug] [2025-07-09T20:00:42.688Z] Could not find VSCode notification endpoint: FetchError: request to http://localhost:40001/vscode/notify failed, reason: connect ECONNREFUSED 127.0.0.1:40001. If you are not running the Firebase Data Connect VSCode extension, this is expected and not an issue.
[info] 
┌─────────────────────────────────────────────────────────────┐
│ ✔  All emulators ready! It is now safe to connect your app. │
│ i  View Emulator UI at http://127.0.0.1:4000/               │
└─────────────────────────────────────────────────────────────┘

┌───────────┬────────────────┬─────────────────────────────────┐
│ Emulator  │ Host:Port      │ View in Emulator UI             │
├───────────┼────────────────┼─────────────────────────────────┤
│ Firestore │ 127.0.0.1:8080 │ http://127.0.0.1:4000/firestore │
└───────────┴────────────────┴─────────────────────────────────┘
  Emulator Hub host: 127.0.0.1 port: 4400
  Other reserved ports: 4500, 9150

Issues? Report them at https://github.com/firebase/firebase-tools/issues and attach the *-debug.log files.
 
[debug] [2025-07-11T11:37:53.227Z] ----------------------------------------------------------------------
[debug] [2025-07-11T11:37:53.236Z] Command:       /nix/store/rbdrkcs5kkwpalxcd7c6bnm33lk2955n-nodejs-20.19.0/bin/node /nix/store/fprgfkwna33crhc86jqbf5878piivvgw-firebase-tools-14.7.0/lib/node_modules/firebase-tools/lib/bin/firebase.js emulators:start --project=demo-app --only=auth,firestore
[debug] [2025-07-11T11:37:53.237Z] CLI Version:   14.7.0
[debug] [2025-07-11T11:37:53.237Z] Platform:      linux
[debug] [2025-07-11T11:37:53.238Z] Node Version:  v20.19.0
[debug] [2025-07-11T11:37:53.239Z] Time:          Fri Jul 11 2025 11:37:53 GMT+0000 (Coordinated Universal Time)
[debug] [2025-07-11T11:37:53.239Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-07-11T11:37:53.244Z] >>> [apiv2][query] GET https://firebase-public.firebaseio.com/cli.json [none]
[debug] [2025-07-11T11:37:58.014Z] <<< [apiv2][status] GET https://firebase-public.firebaseio.com/cli.json 200
[debug] [2025-07-11T11:37:58.019Z] <<< [apiv2][body] GET https://firebase-public.firebaseio.com/cli.json {"cloudBuildErrorAfter":1594252800000,"cloudBuildWarnAfter":1590019200000,"defaultNode10After":1594252800000,"minVersion":"3.0.5","node8DeploysDisabledAfter":1613390400000,"node8RuntimeDisabledAfter":1615809600000,"node8WarnAfter":1600128000000}
[debug] [2025-07-11T11:37:58.976Z] openjdk version "21.0.5" 2024-10-15

[debug] [2025-07-11T11:37:58.977Z] OpenJDK Runtime Environment (build 21.0.5+1-nixos)
OpenJDK 64-Bit Server VM (build 21.0.5+1-nixos, mixed mode, sharing)

[debug] [2025-07-11T11:37:59.034Z] Parsed Java major version: 21
[info] i  emulators: Starting emulators: firestore {"metadata":{"emulator":{"name":"hub"},"message":"Starting emulators: firestore"}}
[info] i  emulators: Detected demo project ID "demo-app", emulated services will use a demo configuration and attempts to access non-emulated services for this project will fail. {"metadata":{"emulator":{"name":"hub"},"message":"Detected demo project ID \"demo-app\", emulated services will use a demo configuration and attempts to access non-emulated services for this project will fail."}}
[warn] ⚠  auth: Not starting the auth emulator, make sure you have run firebase init. {"metadata":{"emulator":{"name":"auth"},"message":"Not starting the auth emulator, make sure you have run firebase init."}}
[warn] ⚠  hub: Error when trying to check port 4400 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4400 {"metadata":{"emulator":{"name":"hub"},"message":"Error when trying to check port 4400 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4400"}}
[warn] ⚠  hub: Port 4400 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"hub"},"message":"Port 4400 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  hub: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"hub"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  ui: Error when trying to check port 4000 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4000 {"metadata":{"emulator":{"name":"ui"},"message":"Error when trying to check port 4000 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4000"}}
[warn] ⚠  ui: Port 4000 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"ui"},"message":"Port 4000 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  ui: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"ui"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  logging: Error when trying to check port 4500 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4500 {"metadata":{"emulator":{"name":"logging"},"message":"Error when trying to check port 4500 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4500"}}
[warn] ⚠  logging: Port 4500 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"logging"},"message":"Port 4500 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  logging: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"logging"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  firestore: Error when trying to check port 8080 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:8080 {"metadata":{"emulator":{"name":"firestore"},"message":"Error when trying to check port 8080 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:8080"}}
[warn] ⚠  firestore: Port 8080 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"firestore"},"message":"Port 8080 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  firestore: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"firestore"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  firestore.websocket: Error when trying to check port 9150 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:9150 {"metadata":{"emulator":{"name":"firestore"},"message":"Error when trying to check port 9150 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:9150"}}
[warn] ⚠  firestore: Port 9150 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"firestore"},"message":"Port 9150 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  firestore: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"firestore"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[debug] [2025-07-11T11:37:59.060Z] assigned listening specs for emulators {"user":{"hub":[{"address":"127.0.0.1","family":"IPv4","port":4400}],"ui":[{"address":"127.0.0.1","family":"IPv4","port":4000}],"logging":[{"address":"127.0.0.1","family":"IPv4","port":4500}],"firestore":[{"address":"127.0.0.1","family":"IPv4","port":8080}],"firestore.websocket":[{"address":"127.0.0.1","family":"IPv4","port":9150}]},"metadata":{"message":"assigned listening specs for emulators"}}
[debug] [2025-07-11T11:37:59.073Z] [hub] writing locator at /tmp/hub-demo-app.json
[debug] [2025-07-11T11:37:59.111Z] Ignoring unsupported arg: auto_download {"metadata":{"emulator":{"name":"firestore"},"message":"Ignoring unsupported arg: auto_download"}}
[debug] [2025-07-11T11:37:59.112Z] Ignoring unsupported arg: single_project_mode_error {"metadata":{"emulator":{"name":"firestore"},"message":"Ignoring unsupported arg: single_project_mode_error"}}
[debug] [2025-07-11T11:37:59.112Z] Starting Firestore Emulator with command {"binary":"java","args":["-Dgoogle.cloud_firestore.debug_log_level=FINE","-Duser.language=en","-jar","/nix/store/w60wgw0k95kiq4yl5f561xhydyg07gf7-emulators/cloud-firestore-emulator-v1.19.8.jar","--host","127.0.0.1","--port",8080,"--websocket_port",9150,"--project_id","demo-app","--rules","/home/user/studio/firestore.rules","--single_project_mode",true],"optionalArgs":["port","webchannel_port","host","rules","websocket_port","functions_emulator","seed_from_export","project_id","single_project_mode"],"joinArgs":false,"shell":false,"port":8080} {"metadata":{"emulator":{"name":"firestore"},"message":"Starting Firestore Emulator with command {\"binary\":\"java\",\"args\":[\"-Dgoogle.cloud_firestore.debug_log_level=FINE\",\"-Duser.language=en\",\"-jar\",\"/nix/store/w60wgw0k95kiq4yl5f561xhydyg07gf7-emulators/cloud-firestore-emulator-v1.19.8.jar\",\"--host\",\"127.0.0.1\",\"--port\",8080,\"--websocket_port\",9150,\"--project_id\",\"demo-app\",\"--rules\",\"/home/user/studio/firestore.rules\",\"--single_project_mode\",true],\"optionalArgs\":[\"port\",\"webchannel_port\",\"host\",\"rules\",\"websocket_port\",\"functions_emulator\",\"seed_from_export\",\"project_id\",\"single_project_mode\"],\"joinArgs\":false,\"shell\":false,\"port\":8080}"}}
[info] i  firestore: Firestore Emulator logging to firestore-debug.log {"metadata":{"emulator":{"name":"firestore"},"message":"Firestore Emulator logging to firestore-debug.log"}}
[debug] [2025-07-11T11:38:05.472Z] Jul 11, 2025 11:38:05 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketServer start
INFO: Started WebSocket server on ws://127.0.0.1:9150
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 11, 2025 11:38:05 AM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketServer start\nINFO: Started WebSocket server on ws://127.0.0.1:9150\n"}}
[debug] [2025-07-11T11:38:05.620Z] API endpoint: http://127.0.0.1:8080
If you are using a library that supports the FIRESTORE_EMULATOR_HOST environment variable, run:

   export FIRESTORE_EMULATOR_HOST=127.0.0.1:8080

If you are running a Firestore in Datastore Mode project, run:

   export DATASTORE_EMULATOR_HOST=127.0.0.1:8080

Note: Support for Datastore Mode is in preview. If you encounter any bugs please file at https://github.com/firebase/firebase-tools/issues.
Dev App Server is now running.

 {"metadata":{"emulator":{"name":"firestore"},"message":"API endpoint: http://127.0.0.1:8080\nIf you are using a library that supports the FIRESTORE_EMULATOR_HOST environment variable, run:\n\n   export FIRESTORE_EMULATOR_HOST=127.0.0.1:8080\n\nIf you are running a Firestore in Datastore Mode project, run:\n\n   export DATASTORE_EMULATOR_HOST=127.0.0.1:8080\n\nNote: Support for Datastore Mode is in preview. If you encounter any bugs please file at https://github.com/firebase/firebase-tools/issues.\nDev App Server is now running.\n\n"}}
[info] ✔  firestore: Firestore Emulator UI websocket is running on 9150. {"metadata":{"emulator":{"name":"firestore"},"message":"Firestore Emulator UI websocket is running on 9150."}}
[debug] [2025-07-11T11:38:05.838Z] Could not find VSCode notification endpoint: FetchError: request to http://localhost:40001/vscode/notify failed, reason: connect ECONNREFUSED 127.0.0.1:40001. If you are not running the Firebase Data Connect VSCode extension, this is expected and not an issue.
[info] 
┌─────────────────────────────────────────────────────────────┐
│ ✔  All emulators ready! It is now safe to connect your app. │
│ i  View Emulator UI at http://127.0.0.1:4000/               │
└─────────────────────────────────────────────────────────────┘

┌───────────┬────────────────┬─────────────────────────────────┐
│ Emulator  │ Host:Port      │ View in Emulator UI             │
├───────────┼────────────────┼─────────────────────────────────┤
│ Firestore │ 127.0.0.1:8080 │ http://127.0.0.1:4000/firestore │
└───────────┴────────────────┴─────────────────────────────────┘
  Emulator Hub host: 127.0.0.1 port: 4400
  Other reserved ports: 4500, 9150

Issues? Report them at https://github.com/firebase/firebase-tools/issues and attach the *-debug.log files.
 
[debug] [2025-07-11T19:03:14.980Z] ----------------------------------------------------------------------
[debug] [2025-07-11T19:03:15.003Z] Command:       /nix/store/rbdrkcs5kkwpalxcd7c6bnm33lk2955n-nodejs-20.19.0/bin/node /nix/store/fprgfkwna33crhc86jqbf5878piivvgw-firebase-tools-14.7.0/lib/node_modules/firebase-tools/lib/bin/firebase.js emulators:start --project=demo-app --only=auth,firestore
[debug] [2025-07-11T19:03:15.008Z] CLI Version:   14.7.0
[debug] [2025-07-11T19:03:15.008Z] Platform:      linux
[debug] [2025-07-11T19:03:15.008Z] Node Version:  v20.19.0
[debug] [2025-07-11T19:03:15.008Z] Time:          Fri Jul 11 2025 19:03:15 GMT+0000 (Coordinated Universal Time)
[debug] [2025-07-11T19:03:15.009Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-07-11T19:03:17.562Z] openjdk version "21.0.5" 2024-10-15

[debug] [2025-07-11T19:03:17.563Z] OpenJDK Runtime Environment (build 21.0.5+1-nixos)
OpenJDK 64-Bit Server VM (build 21.0.5+1-nixos, mixed mode, sharing)

[debug] [2025-07-11T19:03:17.626Z] Parsed Java major version: 21
[info] i  emulators: Starting emulators: firestore {"metadata":{"emulator":{"name":"hub"},"message":"Starting emulators: firestore"}}
[info] i  emulators: Detected demo project ID "demo-app", emulated services will use a demo configuration and attempts to access non-emulated services for this project will fail. {"metadata":{"emulator":{"name":"hub"},"message":"Detected demo project ID \"demo-app\", emulated services will use a demo configuration and attempts to access non-emulated services for this project will fail."}}
[warn] ⚠  auth: Not starting the auth emulator, make sure you have run firebase init. {"metadata":{"emulator":{"name":"auth"},"message":"Not starting the auth emulator, make sure you have run firebase init."}}
[warn] ⚠  hub: Error when trying to check port 4400 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4400 {"metadata":{"emulator":{"name":"hub"},"message":"Error when trying to check port 4400 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4400"}}
[warn] ⚠  hub: Port 4400 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"hub"},"message":"Port 4400 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  hub: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"hub"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  ui: Error when trying to check port 4000 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4000 {"metadata":{"emulator":{"name":"ui"},"message":"Error when trying to check port 4000 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4000"}}
[warn] ⚠  ui: Port 4000 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"ui"},"message":"Port 4000 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  ui: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"ui"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  logging: Error when trying to check port 4500 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4500 {"metadata":{"emulator":{"name":"logging"},"message":"Error when trying to check port 4500 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:4500"}}
[warn] ⚠  logging: Port 4500 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"logging"},"message":"Port 4500 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  logging: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"logging"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  firestore: Error when trying to check port 8080 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:8080 {"metadata":{"emulator":{"name":"firestore"},"message":"Error when trying to check port 8080 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:8080"}}
[warn] ⚠  firestore: Port 8080 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"firestore"},"message":"Port 8080 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  firestore: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"firestore"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[warn] ⚠  firestore.websocket: Error when trying to check port 9150 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:9150 {"metadata":{"emulator":{"name":"firestore"},"message":"Error when trying to check port 9150 on ::1: Error: listen EADDRNOTAVAIL: address not available ::1:9150"}}
[warn] ⚠  firestore: Port 9150 is available on 127.0.0.1 but not ::1. This may cause issues with some clients. {"metadata":{"emulator":{"name":"firestore"},"message":"Port 9150 is available on 127.0.0.1 but not ::1. This may cause issues with some clients."}}
[warn] ⚠  firestore: If you encounter connectivity issues, consider switching to a different port or explicitly specifying "host": "<ip address>" instead of hostname in firebase.json {"metadata":{"emulator":{"name":"firestore"},"message":"If you encounter connectivity issues, consider switching to a different port or explicitly specifying \"host\": \"<ip address>\" instead of hostname in firebase.json"}}
[debug] [2025-07-11T19:03:17.647Z] assigned listening specs for emulators {"user":{"hub":[{"address":"127.0.0.1","family":"IPv4","port":4400}],"ui":[{"address":"127.0.0.1","family":"IPv4","port":4000}],"logging":[{"address":"127.0.0.1","family":"IPv4","port":4500}],"firestore":[{"address":"127.0.0.1","family":"IPv4","port":8080}],"firestore.websocket":[{"address":"127.0.0.1","family":"IPv4","port":9150}]},"metadata":{"message":"assigned listening specs for emulators"}}
[debug] [2025-07-11T19:03:17.658Z] [hub] writing locator at /tmp/hub-demo-app.json
[debug] [2025-07-11T19:03:17.689Z] Ignoring unsupported arg: auto_download {"metadata":{"emulator":{"name":"firestore"},"message":"Ignoring unsupported arg: auto_download"}}
[debug] [2025-07-11T19:03:17.689Z] Ignoring unsupported arg: single_project_mode_error {"metadata":{"emulator":{"name":"firestore"},"message":"Ignoring unsupported arg: single_project_mode_error"}}
[debug] [2025-07-11T19:03:17.690Z] Starting Firestore Emulator with command {"binary":"java","args":["-Dgoogle.cloud_firestore.debug_log_level=FINE","-Duser.language=en","-jar","/nix/store/w60wgw0k95kiq4yl5f561xhydyg07gf7-emulators/cloud-firestore-emulator-v1.19.8.jar","--host","127.0.0.1","--port",8080,"--websocket_port",9150,"--project_id","demo-app","--rules","/home/user/studio/firestore.rules","--single_project_mode",true],"optionalArgs":["port","webchannel_port","host","rules","websocket_port","functions_emulator","seed_from_export","project_id","single_project_mode"],"joinArgs":false,"shell":false,"port":8080} {"metadata":{"emulator":{"name":"firestore"},"message":"Starting Firestore Emulator with command {\"binary\":\"java\",\"args\":[\"-Dgoogle.cloud_firestore.debug_log_level=FINE\",\"-Duser.language=en\",\"-jar\",\"/nix/store/w60wgw0k95kiq4yl5f561xhydyg07gf7-emulators/cloud-firestore-emulator-v1.19.8.jar\",\"--host\",\"127.0.0.1\",\"--port\",8080,\"--websocket_port\",9150,\"--project_id\",\"demo-app\",\"--rules\",\"/home/user/studio/firestore.rules\",\"--single_project_mode\",true],\"optionalArgs\":[\"port\",\"webchannel_port\",\"host\",\"rules\",\"websocket_port\",\"functions_emulator\",\"seed_from_export\",\"project_id\",\"single_project_mode\"],\"joinArgs\":false,\"shell\":false,\"port\":8080}"}}
[info] i  firestore: Firestore Emulator logging to firestore-debug.log {"metadata":{"emulator":{"name":"firestore"},"message":"Firestore Emulator logging to firestore-debug.log"}}
[debug] [2025-07-11T19:03:23.599Z] Jul 11, 2025 7:03:23 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketServer start
INFO: Started WebSocket server on ws://127.0.0.1:9150
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 11, 2025 7:03:23 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketServer start\nINFO: Started WebSocket server on ws://127.0.0.1:9150\n"}}
[debug] [2025-07-11T19:03:23.708Z] API endpoint: http://127.0.0.1:8080
 {"metadata":{"emulator":{"name":"firestore"},"message":"API endpoint: http://127.0.0.1:8080\n"}}
[debug] [2025-07-11T19:03:23.709Z] If you are using a library that supports the FIRESTORE_EMULATOR_HOST environment variable, run:

   export FIRESTORE_EMULATOR_HOST=127.0.0.1:8080

If you are running a Firestore in Datastore Mode project, run:

   export DATASTORE_EMULATOR_HOST=127.0.0.1:8080

Note: Support for Datastore Mode is in preview. If you encounter any bugs please file at https://github.com/firebase/firebase-tools/issues.
Dev App Server is now running.

 {"metadata":{"emulator":{"name":"firestore"},"message":"If you are using a library that supports the FIRESTORE_EMULATOR_HOST environment variable, run:\n\n   export FIRESTORE_EMULATOR_HOST=127.0.0.1:8080\n\nIf you are running a Firestore in Datastore Mode project, run:\n\n   export DATASTORE_EMULATOR_HOST=127.0.0.1:8080\n\nNote: Support for Datastore Mode is in preview. If you encounter any bugs please file at https://github.com/firebase/firebase-tools/issues.\nDev App Server is now running.\n\n"}}
[info] ✔  firestore: Firestore Emulator UI websocket is running on 9150. {"metadata":{"emulator":{"name":"firestore"},"message":"Firestore Emulator UI websocket is running on 9150."}}
[debug] [2025-07-11T19:03:23.893Z] Could not find VSCode notification endpoint: FetchError: request to http://localhost:40001/vscode/notify failed, reason: connect ECONNREFUSED 127.0.0.1:40001. If you are not running the Firebase Data Connect VSCode extension, this is expected and not an issue.
[info] 
┌─────────────────────────────────────────────────────────────┐
│ ✔  All emulators ready! It is now safe to connect your app. │
│ i  View Emulator UI at http://127.0.0.1:4000/               │
└─────────────────────────────────────────────────────────────┘

┌───────────┬────────────────┬─────────────────────────────────┐
│ Emulator  │ Host:Port      │ View in Emulator UI             │
├───────────┼────────────────┼─────────────────────────────────┤
│ Firestore │ 127.0.0.1:8080 │ http://127.0.0.1:4000/firestore │
└───────────┴────────────────┴─────────────────────────────────┘
  Emulator Hub host: 127.0.0.1 port: 4400
  Other reserved ports: 4500, 9150

Issues? Report them at https://github.com/firebase/firebase-tools/issues and attach the *-debug.log files.
 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-11T21:46:42.259Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-11T21:46:42.261Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"rules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    \n    // Helper function to check if a user is an admin or owner\n    function isPrivileged(userId) {\n      return get(/databases/$(database)/documents/users/$(userId)).data.role in ['admin', 'owner'];\n    }\n\n    // Helper function to check if a user is the owner\n    function isOwner(userId) {\n      return get(/databases/$(database)/documents/users/$(userId)).data.role == 'owner';\n    }\n\n    // Users Collection\n    match /users/{userId} {\n      // Any authenticated user can create their own user document (sign up).\n      allow create: if request.auth != null && request.auth.uid == userId;\n      \n      // A user can read their own profile. Owners can read any profile.\n      allow read: if request.auth != null && (request.auth.uid == userId || isOwner(request.auth.uid));\n      \n      // A user can update their own profile. Owners can update any user's role, but not make another owner.\n      allow update: if request.auth != null && \n                    (request.auth.uid == userId || \n                      (isOwner(request.auth.uid) && request.resource.data.role != 'owner'));\n    }\n\n    // Push Subscriptions Subcollection\n    match /users/{userId}/pushSubscriptions/{subscriptionId} {\n      // A user can manage their own push subscriptions.\n      allow read, write, delete: if request.auth != null && request.auth.uid == userId;\n    }\n\n    // Shifts Collection\n    match /shifts/{shiftId} {\n      // Only privileged users (admin, owner) can create/delete shifts.\n      allow create, delete: if request.auth != null && isPrivileged(request.auth.uid);\n      \n      // Authenticated users can read shifts, and update their own shifts.\n      allow read: if request.auth != null;\n      allow update: if request.auth != null && request.auth.uid == resource.data.userId;\n    }\n    \n    // Projects Collection\n    match /projects/{projectId} {\n       // Only privileged users (admin, owner) can create/delete projects.\n      allow create, delete: if request.auth != null && isPrivileged(request.auth.uid);\n      // Any authenticated user can read the list of projects.\n      allow read, update: if request.auth != null;\n\n      // Files Subcollection\n      match /files/{fileId} {\n        // Any authenticated user can create (upload) a file.\n        allow create: if request.auth != null;\n        // Any authenticated user can read files.\n        allow read: if request.auth != null;\n        // The user who uploaded the file, or a privileged user, can delete it.\n        allow delete: if request.auth != null && (isPrivileged(request.auth.uid) || request.auth.uid == resource.data.uploaderId);\n      }\n    }\n\n    // Announcements Collection\n    match /announcements/{announcementId} {\n      // Only privileged users can create/update/delete announcements.\n      allow create, update, delete: if request.auth != null && isPrivileged(request.auth.uid);\n      // Any authenticated user can read announcements.\n      allow read: if request.auth != null;\n    }\n\n    // Settings Collection\n    match /settings/notifications {\n      // Any authenticated user can read the notification settings.\n      allow read: if request.auth != null;\n      // Only the owner can change the notification settings.\n      allow write: if request.auth != null && isOwner(request.auth.uid);\n    }\n  }\n}\n"}]}}
[debug] [2025-07-11T21:46:42.397Z] Jul 11, 2025 9:46:42 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 11, 2025 9:46:42 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-11T21:46:43.569Z] Jul 11, 2025 9:46:43 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 11, 2025 9:46:43 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected HTTP/2 connection.\n"}}
[debug] [2025-07-11T21:46:46.124Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-11T21:46:46.125Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-11T21:48:24.837Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-11T21:48:24.837Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"rules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Helper function to check if a user has a specific role\n    function isRole(role) {\n      return get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == role;\n    }\n\n    // USERS collection\n    match /users/{userId} {\n      // Anyone can create their own user profile (on signup)\n      allow create: if request.auth.uid == userId;\n      // Users can only read their own profile, admins and owners can read any profile\n      allow read: if request.auth.uid == userId || isRole('admin') || isRole('owner');\n      // Users can update their own profile, but cannot change their role.\n      // Owners can update any user's profile.\n      allow update: if (request.auth.uid == userId && request.resource.data.role == resource.data.role) || isRole('owner');\n    }\n\n    // USERS/SUBSCRIPTIONS subcollection\n    match /users/{userId}/pushSubscriptions/{subscriptionId} {\n      // A user can manage their own push notification subscriptions\n      allow read, write, delete: if request.auth.uid == userId;\n    }\n\n    // SHIFTS collection\n    match /shifts/{shiftId} {\n      // Admins and Owners can read all shifts\n      allow read: if isRole('admin') || isRole('owner');\n       // Only allow users to read shifts assigned to them\n      allow read: if resource.data.userId == request.auth.uid;\n      // Admins and Owners can create, update, and delete any shift\n      allow write: if isRole('admin') || isRole('owner');\n      // Users can update their own shifts (e.g., to change status), but not create/delete them\n      allow update: if resource.data.userId == request.auth.uid;\n    }\n    \n    // ANNOUNCEMENTS collection\n    match /announcements/{announcementId} {\n      // Any authenticated user can read announcements\n      allow read: if request.auth != null;\n      // Only admins and owners can create, update, or delete announcements\n      allow write: if isRole('admin') || isRole('owner');\n    }\n\n    // PROJECTS and subcollections\n    match /projects/{projectId} {\n      // Any authenticated user can read project details\n      allow read: if request.auth != null;\n      // Admins and owners can create and delete projects\n      allow create, delete: if isRole('admin') || isRole('owner');\n\n      match /files/{fileId} {\n        // Any authenticated user can read file details\n        allow read: if request.auth != null;\n        // Any authenticated user can upload files (create file documents)\n        allow create: if request.auth != null;\n        // Users can delete their own files. Admins/owners can delete any file.\n        allow delete: if resource.data.uploaderId == request.auth.uid || isRole('admin') || isRole('owner');\n      }\n    }\n    \n    // SETTINGS collection\n    match /settings/notifications {\n      // Any authenticated user can READ the notification setting\n      allow read: if request.auth != null;\n      // Only the OWNER can WRITE (toggle) the notification setting\n      allow write: if isRole('owner');\n    }\n  }\n}\n"}]}}
[debug] [2025-07-11T21:48:24.863Z] Jul 11, 2025 9:48:24 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 11, 2025 9:48:24 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-11T21:48:25.077Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-11T21:48:25.082Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-11T21:52:04.883Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-11T21:52:04.884Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":""}]}}
[debug] [2025-07-11T21:52:04.936Z] Jul 11, 2025 9:52:04 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 11, 2025 9:52:04 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-11T21:52:04.942Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-11T21:52:04.942Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"rules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    \n    // Helper function to get user profile data\n    function getUserProfile(userId) {\n      return get(/databases/$(database)/documents/users/$(userId)).data;\n    }\n    \n    // Helper function to check if the user has an admin or owner role\n    function isPrivileged(userId) {\n      let userProfile = getUserProfile(userId);\n      return userProfile.role in ['admin', 'owner'];\n    }\n\n    // Helper function to check if the user is the owner\n    function isOwner(userId) {\n      let userProfile = getUserProfile(userId);\n      return userProfile.role == 'owner';\n    }\n\n    // Users can read/write their own data. Owners can read all user data.\n    match /users/{userId} {\n      allow read: if request.auth.uid != null && (request.auth.uid == userId || isOwner(request.auth.uid));\n      allow write: if request.auth.uid != null && request.auth.uid == userId;\n      \n      // Push subscriptions can be created/deleted by the user themselves\n      match /pushSubscriptions/{subscriptionId} {\n        allow read, write, delete: if request.auth.uid != null && request.auth.uid == userId;\n      }\n    }\n    \n    // Shifts can be read by their assigned user or any privileged user.\n    // Shifts can only be created/updated/deleted by a privileged user (via the Admin Panel/File Uploader).\n    match /shifts/{shiftId} {\n      allow read: if request.auth.uid != null && (request.auth.uid == resource.data.userId || isPrivileged(request.auth.uid));\n      allow create: if request.auth.uid != null && isPrivileged(request.auth.uid);\n      allow update, delete: if request.auth.uid != null && isPrivileged(request.auth.uid);\n    }\n    \n    // Projects and their files can be read by anyone logged in.\n    // They can only be created/updated/deleted by privileged users.\n    match /projects/{projectId} {\n      allow read: if request.auth.uid != null;\n      allow create, update, delete: if request.auth.uid != null && isPrivileged(request.auth.uid);\n      \n      match /files/{fileId} {\n        allow read: if request.auth.uid != null;\n        allow create: if request.auth.uid != null; // Allow any authenticated user to upload\n        allow delete: if request.auth.uid != null && (isPrivileged(request.auth.uid) || request.auth.uid == resource.data.uploaderId);\n      }\n    }\n    \n    // Announcements can be read by anyone logged in.\n    // They can only be created/updated/deleted by privileged users.\n    match /announcements/{announcementId} {\n        allow read: if request.auth.uid != null;\n        allow create, update, delete: if request.auth.uid != null && isPrivileged(request.auth.uid);\n    }\n\n    // Settings can be read by any authenticated user, but only written by the owner.\n    match /settings/{docId} {\n      allow read: if request.auth.uid != null;\n      allow write: if request.auth.uid != null && isOwner(request.auth.uid);\n    }\n\n  }\n}"}]}}
[debug] [2025-07-11T21:52:04.969Z] Jul 11, 2025 9:52:04 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 11, 2025 9:52:04 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-11T21:52:05.430Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-11T21:52:05.430Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules"},"description":"Rules content empty. Compilation aborted.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:0:0 - ERROR Rules content empty. Compilation aborted. 
[info] ✔  firestore: Rules updated. 
[debug] [2025-07-11T21:52:05.485Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-11T21:52:05.488Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-11T21:54:34.117Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-11T21:54:34.124Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"rules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    \n    // Check if a user has a specific role ('admin' or 'owner')\n    function isRole(role) {\n      return get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == role;\n    }\n    \n    function isOwner() {\n      return isRole('owner');\n    }\n    \n    function isAdmin() {\n      return isRole('admin');\n    }\n    \n    function isOwnerOrAdmin() {\n      return isOwner() || isAdmin();\n    }\n    \n    // USERS\n    match /users/{userId} {\n      // Any authenticated user can create their own user document upon signing up.\n      allow create: if request.auth.uid == userId;\n\n      // Users can only read their own data. Admins and owners can read any user's data.\n      allow read: if request.auth.uid == userId || isOwnerOrAdmin();\n      \n      // Users can only update their own data. The owner can update any user's role.\n      allow update: if (request.auth.uid == userId) || \n                       (isOwner() && 'role' in request.resource.data);\n\n      // Only the owner can delete users (a feature not currently implemented, but good to have).\n      allow delete: if isOwner();\n      \n      // Push notification subscriptions\n      match /pushSubscriptions/{subscriptionId} {\n        // Users can only manage their own subscriptions.\n        allow read, write, delete: if request.auth.uid == userId;\n      }\n    }\n    \n    // SHIFTS\n    match /shifts/{shiftId} {\n        // Any authenticated user can read shifts assigned to them. Admins/owners can read all shifts.\n        allow read: if request.auth.uid == resource.data.userId || isOwnerOrAdmin();\n\n        // Users can update the status of their own shifts. Admins/owners can create, update, and delete any shift.\n        allow write: if (request.auth.uid == resource.data.userId && 'status' in request.resource.data) || isOwnerOrAdmin();\n\n        // Allow owners/admins to create shifts (e.g. via file upload or manual creation)\n        allow create: if isOwnerOrAdmin();\n        \n        // Allow owners/admins to delete shifts\n        allow delete: if isOwnerOrAdmin();\n    }\n\n    // PROJECTS\n    match /projects/{projectId} {\n        // Any authenticated user can view project details.\n        allow read: if request.auth != null;\n        \n        // Only admins and owners can create, update, or delete projects.\n        allow write: if isOwnerOrAdmin();\n\n        // Files subcollection within a project\n        match /files/{fileId} {\n            // Any authenticated user can view files.\n            allow read: if request.auth != null;\n\n            // Any authenticated user can upload (create) a file record.\n            allow create: if request.auth != null;\n\n            // Only the person who uploaded the file, or an admin/owner, can delete it.\n            allow delete: if request.auth.uid == resource.data.uploaderId || isOwnerOrAdmin();\n        }\n    }\n\n    // ANNOUNCEMENTS\n    match /announcements/{announcementId} {\n        // Any authenticated user can read announcements.\n        allow read: if request.auth != null;\n        \n        // Only admins and owners can create, update, or delete announcements.\n        allow write: if isOwnerOrAdmin();\n    }\n\n    // GLOBAL SETTINGS (for notification toggle)\n    match /settings/{settingId} {\n        // Any authenticated user can READ the notification setting.\n        allow read: if request.auth != null;\n\n        // ONLY the 'owner' can WRITE to the notification setting.\n        allow write: if isOwner();\n    }\n  }\n}\n"}]}}
[debug] [2025-07-11T21:54:34.165Z] Jul 11, 2025 9:54:34 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 11, 2025 9:54:34 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-11T21:54:34.357Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-11T21:54:34.359Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-11T21:57:15.361Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-11T21:57:15.361Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"rules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Helper function to check for admin or owner roles\n    function isPrivileged() {\n      return get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role in ['admin', 'owner'];\n    }\n\n    // /users/{userId}\n    match /users/{userId} {\n      // Anyone can create a user account (sign up).\n      allow create: if request.auth.uid == userId;\n      // Only authenticated users can see the user list.\n      allow list: if request.auth != null;\n      // Users can read their own profile. Admins/owners can read anyone's profile.\n      allow get: if request.auth.uid == userId || isPrivileged();\n      // Users can update their own profile. Owners can update any user's profile.\n      allow update: if request.auth.uid == userId || get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'owner';\n      // Only the owner can delete a user.\n      allow delete: if get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'owner';\n    }\n\n    // /users/{userId}/pushSubscriptions/{subscriptionId}\n    match /users/{userId}/pushSubscriptions/{subscriptionId} {\n      // Users can manage their own push notification subscriptions.\n      allow read, write, delete: if request.auth.uid == userId;\n    }\n\n    // /shifts/{shiftId}\n    match /shifts/{shiftId} {\n        // Any authenticated user can read their own shifts. Admins/owners can read all shifts.\n        allow get: if request.auth.uid == resource.data.userId || isPrivileged();\n        allow list: if isPrivileged(); // Only privileged users can query the whole collection.\n\n        // Admins/owners can create, update, and delete shifts for anyone.\n        // Regular users can update their own shifts (e.g., to change status).\n        allow create: if isPrivileged();\n        allow update: if isPrivileged() || request.auth.uid == resource.data.userId;\n        allow delete: if isPrivileged();\n    }\n    \n    // /projects/{projectId}\n    match /projects/{projectId} {\n        // Any authenticated user can view all projects.\n        allow read: if request.auth != null;\n        // Only admins/owners can create or delete projects.\n        allow create, delete, update: if isPrivileged();\n        \n        // /projects/{projectId}/files/{fileId}\n        match /files/{fileId} {\n            // Any authenticated user can read files.\n            allow read: if request.auth != null;\n            // Any authenticated user can upload (create) a file record.\n            allow create: if request.auth != null;\n            // The user who uploaded the file, or an admin/owner, can delete it.\n            allow delete: if request.auth.uid == resource.data.uploaderId || isPrivileged();\n        }\n    }\n    \n    // /announcements/{announcementId}\n    match /announcements/{announcementId} {\n        // Any authenticated user can read announcements.\n        allow read: if request.auth != null;\n        // Only admins/owners can create, update, or delete announcements.\n        allow write: if isPrivileged();\n    }\n\n    // /settings/notifications\n    match /settings/notifications {\n      // Any authenticated user can read the master toggle state.\n      allow read: if request.auth != null;\n      \n      // Only the user with the 'owner' role can change it.\n      allow write: if get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'owner';\n    }\n  }\n}\n"}]}}
[debug] [2025-07-11T21:57:15.372Z] Jul 11, 2025 9:57:15 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 11, 2025 9:57:15 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-11T21:57:15.597Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-11T21:57:15.597Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-11T21:58:52.259Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-11T21:58:52.266Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n  \n    // Helper function to get the role of the currently authenticated user.\n    function getUserRole(userId) {\n      return get(/databases/$(database)/documents/users/$(userId)).data.role;\n    }\n    \n    // Helper function to check if the user has a privileged role (admin or owner).\n    function isPrivileged(userId) {\n      let userRole = getUserRole(userId);\n      return userRole == 'admin' || userRole == 'owner';\n    }\n    \n    // Helper function to check if the user is the designated owner of the app.\n    function isOwner(userId) {\n      return getUserRole(userId) == 'owner';\n    }\n\n    // /users/{userId}\n    match /users/{userId} {\n      // Any user can create their own user document upon signing up.\n      allow create: if request.auth.uid == userId;\n      \n      // A user can read their own profile. Admins/owners can read any profile.\n      allow read: if request.auth.uid == userId || isPrivileged(request.auth.uid);\n      \n      // A user can update their own profile data. Owners can update any user's role.\n      allow update: if request.auth.uid == userId || isOwner(request.auth.uid);\n      \n      // No user should be able to delete user documents directly.\n      allow delete: if false;\n      \n      // Subscriptions subcollection\n      match /pushSubscriptions/{subscriptionId} {\n        // A user can manage their own push notification subscriptions.\n        allow read, write, delete: if request.auth.uid == userId;\n      }\n    }\n    \n    // /shifts/{shiftId}\n    match /shifts/{shiftId} {\n        // Admins and owners can create, update, and delete any shift.\n        allow create, delete: if isPrivileged(request.auth.uid);\n        \n        // Users can read any shift (for team schedule view).\n        // Admins/Owners can update any shift.\n        // A regular user can only update their own assigned shifts (e.g., changing status).\n        allow read, update: if request.auth != null && \n                              (isPrivileged(request.auth.uid) || resource.data.userId == request.auth.uid);\n    }\n    \n    // /settings/notifications\n    match /settings/notifications {\n      // Any authenticated user can read the master toggle state.\n      allow read: if request.auth != null;\n      \n      // Only the user with the 'owner' role can change it.\n      allow write: if isOwner(request.auth.uid);\n    }\n\n    // /projects/{projectId}\n    match /projects/{projectId} {\n        // Any authenticated user can view the list of projects.\n        allow read: if request.auth != null;\n        \n        // Only admins or owners can create, update, or delete projects.\n        allow create, update, delete: if isPrivileged(request.auth.uid);\n        \n        // Files subcollection\n        match /files/{fileId} {\n            // Any authenticated user can view the file list for any project.\n            allow read: if request.auth != null;\n            \n            // Any authenticated user can upload a file (create a file document).\n            allow create: if request.auth != null;\n            \n            // Only the user who uploaded the file, or an admin/owner, can delete it.\n            allow delete: if request.auth != null && \n                          (isPrivileged(request.auth.uid) || resource.data.uploaderId == request.auth.uid);\n            \n            // File documents are not designed to be updated.\n            allow update: if false;\n        }\n    }\n    \n    // /announcements/{announcementId}\n    match /announcements/{announcementId} {\n        // Any authenticated user can read announcements.\n        allow read: if request.auth != null;\n        \n        // Only admins or owners can create, update, or delete announcements.\n        allow create, update, delete: if isPrivileged(request.auth.uid);\n    }\n    \n  }\n}\n"}]}}
[debug] [2025-07-11T21:58:52.287Z] Jul 11, 2025 9:58:52 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 11, 2025 9:58:52 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-11T21:58:52.629Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-11T21:58:52.637Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-11T22:02:10.502Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-11T22:02:10.502Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"rules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n  \n    // Helper function to get user's role from their profile document\n    function getUserRole(userId) {\n      return get(/databases/$(database)/documents/users/$(userId)).data.role;\n    }\n\n    // USERS\n    // Users can read their own profile.\n    // Users can create their own profile upon signup.\n    // Only admins/owners can update other user profiles (except for their own role).\n    match /users/{userId} {\n      allow read: if request.auth.uid == userId;\n      allow create: if request.auth.uid == userId;\n      \n      // Allow user to update their own profile, but not their role.\n      allow update: if request.auth.uid == userId\n                      && !(\"role\" in request.resource.data);\n                      \n      // Allow admins/owners to update other users, but not change an owner's role.\n      allow update: if getUserRole(request.auth.uid) in ['admin', 'owner']\n                      && resource.data.role != 'owner';\n    }\n    \n    // PUSH SUBSCRIPTIONS\n    // Users can only manage their own push notification subscriptions.\n    match /users/{userId}/pushSubscriptions/{subscriptionId} {\n      allow read, write: if request.auth.uid == userId;\n    }\n    \n    // SETTINGS\n    match /settings/{docId} {\n      // Any authenticated user can read settings (e.g., to see if notifications are enabled).\n      allow read: if request.auth != null;\n      // Writes are handled by a secure Cloud Function, so no direct client writes are allowed.\n      allow write: if false; \n    }\n\n    // SHIFTS\n    // Users can read their own shifts.\n    // Admins/owners can read all shifts.\n    // Admins/owners can create/delete shifts.\n    // Users can update the status of their own shifts.\n    match /shifts/{shiftId} {\n      allow read: if request.auth.uid == resource.data.userId \n                  || getUserRole(request.auth.uid) in ['admin', 'owner'];\n                  \n      allow create, delete: if getUserRole(request.auth.uid) in ['admin', 'owner'];\n      \n      // Allow users to update specific fields (status, notes) on their own shifts.\n      allow update: if request.auth.uid == resource.data.userId\n                     && request.resource.data.keys().hasAll(['status', 'notes'])\n                     && request.resource.data.size() == 2;\n                     \n      // Allow admins/owners to update any field on any shift.\n      allow update: if getUserRole(request.auth.uid) in ['admin', 'owner'];\n    }\n    \n    // PROJECTS\n    // All authenticated users can read all projects.\n    // Only admins/owners can create/delete/update projects.\n    match /projects/{projectId} {\n       allow read: if request.auth != null;\n       allow write: if getUserRole(request.auth.uid) in ['admin', 'owner'];\n    }\n    \n    // PROJECT FILES\n    // All authenticated users can read all project files.\n    // Any user can create (upload) a file.\n    // Users can delete their own files. Admins/owners can delete any file.\n    match /projects/{projectId}/files/{fileId} {\n        allow read, create: if request.auth != null;\n        allow delete: if request.auth.uid == resource.data.uploaderId\n                      || getUserRole(request.auth.uid) in ['admin', 'owner'];\n    }\n    \n    // ANNOUNCEMENTS\n    // All authenticated users can read announcements.\n    // Only admins/owners can create/update/delete them.\n    match /announcements/{announcementId} {\n      allow read: if request.auth != null;\n      allow write: if getUserRole(request.auth.uid) in ['admin', 'owner'];\n    }\n    \n  }\n}\n"}]}}
[debug] [2025-07-11T22:02:10.520Z] Jul 11, 2025 10:02:10 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 11, 2025 10:02:10 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-11T22:02:10.775Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-11T22:02:10.776Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {}
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2025-07-11T22:06:42.532Z] >>> [apiv2][query] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules [none]
[debug] [2025-07-11T22:06:42.533Z] >>> [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    \n    // Helper function to check if a user has a specific role\n    function hasRole(role) {\n      return get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == role;\n    }\n\n    // Users can read their own profile, and admins/owners can read anyone's.\n    // Users can create their own profile, but only update their own.\n    // Owners can update anyone's role.\n    match /users/{userId} {\n      allow read: if request.auth.uid == userId || hasRole('admin') || hasRole('owner');\n      allow create: if request.auth.uid == userId;\n      allow update: if request.auth.uid == userId \n                    || (hasRole('owner') && !('role' in request.resource.data.diff(resource.data)));\n      \n      // Separate rule for role changes, only by owner, and not on themselves\n      allow update: if hasRole('owner') \n                      && 'role' in request.resource.data.diff(resource.data)\n                      && request.auth.uid != userId;\n    }\n    \n    // Any authenticated user can read their own push subscriptions.\n    // They can create/delete their own subscriptions.\n    match /users/{userId}/pushSubscriptions/{subscriptionId} {\n      allow read, create, delete: if request.auth.uid == userId;\n    }\n    \n    // Shifts can only be read by the assigned user, an admin, or an owner.\n    // Admins/owners can create, update, and delete any shift.\n    match /shifts/{shiftId} {\n      allow read: if request.auth.uid == resource.data.userId || hasRole('admin') || hasRole('owner');\n      allow create, delete: if hasRole('admin') || hasRole('owner');\n\n      // Users can only update the status of their own shifts.\n      // Admins/owners can update any field.\n      allow update: if (request.auth.uid == resource.data.userId \n                      && request.resource.data.keys().hasOnly(['status', 'notes']))\n                    || hasRole('admin') || hasRole('owner');\n    }\n    \n    // Any authenticated user can view the list of projects and their attached files.\n    match /projects/{projectId} {\n      allow read: if request.auth != null;\n      allow create, delete: if hasRole('admin') || hasRole('owner');\n\n      match /files/{fileId} {\n        allow read: if request.auth != null;\n        // Any authenticated user can upload files\n        allow create: if request.auth != null;\n        // Only the uploader or an admin/owner can delete files\n        allow delete: if request.auth.uid == resource.data.uploaderId || hasRole('admin') || hasRole('owner');\n      }\n    }\n\n    // Any authenticated user can read announcements.\n    // Only admins/owners can create, update, or delete them.\n    match /announcements/{announcementId} {\n        allow read: if request.auth != null;\n        allow create, update, delete: if hasRole('admin') || hasRole('owner');\n    }\n    \n    // No one should be able to read/write the settings directly from the client.\n    // This will be handled by a secure Cloud Function.\n    match /settings/{docId} {\n      allow read, write: if false;\n    }\n  }\n}\n"}]}}
[debug] [2025-07-11T22:06:42.563Z] Jul 11, 2025 10:06:42 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jul 11, 2025 10:06:42 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2025-07-11T22:06:42.798Z] <<< [apiv2][status] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules 200
[debug] [2025-07-11T22:06:42.799Z] <<< [apiv2][body] PUT http://127.0.0.1:8080/emulator/v1/projects/demo-app:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":19,"column":79,"currentOffset":775,"endOffset":778},"description":"Invalid type. Received one of [map_diff]. Expected one of [list, set, map, constraint].","severity":"WARNING"},{"sourcePosition":{"fileName":"security.rules","line":23,"column":58,"currentOffset":981,"endOffset":984},"description":"Invalid type. Received one of [map_diff]. Expected one of [list, set, map, constraint].","severity":"WARNING"}]}
[warn] ⚠  firestore.rules:19:79 - WARNING Invalid type. Received one of [map_diff]. Expected one of [list, set, map, constraint]. 
[warn] ⚠  firestore.rules:23:58 - WARNING Invalid type. Received one of [map_diff]. Expected one of [list, set, map, constraint]. 
[info] ✔  firestore: Rules updated. 
